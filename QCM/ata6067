<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ATA 31 - 34 Chpt 9</title>
<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --ok:#22c55e;
  --bof:#fbbf24;
  --bad:#ef4444;
  --btn:#2563eb;
  --surface:#0b1223;
  --border:#334155;
}
/* ===== Palette inspir√©e du logo Sabena technics ===== */
:root[data-theme="light"]{
  --bg:#f5f7fa;
  --card:#ffffff;
  --text:#111827;           /* Texte principal : noir anthracite */
  --muted:#374151;          /* Sous-titres : gris fonc√© */
  --ok:#007A33;             /* Vert Sabena (validation) */
  --bof:#FFD200;            /* Jaune Sabena */
  --bad:#C1121F;            /* Rouge profond (erreur) */
  --btn:#003366;            /* Bleu Sabena */
  --surface:#f0f4f8;        /* Fond clair homog√®ne */
  --border:#cbd5e1;         /* Bordures neutres */
}

:root[data-theme="light"] .opt{
  color: var(--text);
  background:#ffffff;
  border-color: var(--border);
}
:root[data-theme="light"] .opt:hover,
:root[data-theme="light"] .opt:focus{
  outline: 2px solid var(--btn);
  background: color-mix(in srgb, var(--btn) 6%, #fff);
}
:root[data-theme="light"] .opt.correct{
  outline-color: var(--ok);
  background: color-mix(in srgb, var(--ok) 15%, #fff);
  color: var(--text);
}
:root[data-theme="light"] .opt.wrong{
  outline-color: var(--bad);
  background: color-mix(in srgb, var(--bad) 10%, #fff);
  color: var(--text);
}
:root[data-theme="light"] .badge-status.badge-ok{ color: var(--ok); }
:root[data-theme="light"] .badge-status.badge-bof{ color: var(--bof); }
:root[data-theme="light"] .badge-status.badge-bad{ color: var(--bad); }

:root[data-theme="light"] button{ background: var(--btn); color: #fff; }
:root[data-theme="light"] .btn-gray{ background: var(--surface); color: var(--text); }

html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,Segoe UI,Roboto,sans-serif;
  padding:16px;
  display:flex;
  justify-content:center;   /* ‚úÖ centre horizontalement */
  align-items:flex-start;    /* garde le haut visible (√©vite centrage vertical complet) */
  min-height:100vh;          /* occupe toute la hauteur de la fen√™tre */
}

.card{background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.15);padding:16px}
.main{
  width:100%;
  max-width:900px;
}

.side{width:340px;min-width:300px;max-height:90vh;overflow:auto;display:flex;flex-direction:column;gap:12px}
h1{margin:0 0 10px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
select,input,button{padding:8px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--text)}
button{cursor:pointer;background:var(--btn);color:#fff;border:none}
.btn-gray{background:var(--surface);color:var(--text)}
.pill{background:var(--surface);border:1px solid var(--border);border-radius:999px;padding:6px 10px;display:inline-flex;gap:6px;align-items:center}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.opt{
  background:var(--surface);border:1px solid var(--btn);border-radius:10px;
  padding:14px 16px;cursor:pointer;text-align:left;font-size:1.05rem;font-weight:600;
  transition:transform .12s ease
}
.opt:hover{transform:scale(1.02)}
.opt.correct{outline:2px solid var(--ok);background:rgba(34,197,94,.12)}
.opt.wrong{outline:2px solid var(--bad);background:rgba(239,68,68,.12)}
.muted{color:var(--muted);font-size:.92rem}
.timer{background:var(--surface);border:1px solid var(--border);padding:6px 10px;border-radius:999px}
.badge{background:var(--surface);border:1px solid var(--border);border-radius:999px;padding:2px 8px;font-size:.8rem}
.badge-status{margin-left:8px;padding:2px 10px;border-radius:999px;font-size:.9rem;border:1px solid var(--border);display:none}
.badge-ok{color:var(--ok)}
.badge-bof{color:var(--bof)}
.badge-bad{color:var(--bad)}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid var(--border);text-align:left}
th{color:var(--muted)}
.log{background:var(--surface);padding:10px;border-radius:8px;height:300px;overflow:auto}
.ok{color:var(--ok)} .bof{color:var(--bof)} .bad{color:var(--bad)}
.hl{font-weight:700;text-decoration:underline}
.progressbar{height:8px;background:var(--surface);border:1px solid var(--border);border-radius:999px;overflow:hidden}
.progressbar > div{height:100%;background:var(--btn);width:0%}
.svg-wrap{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:8px}
hr{border:none;border-top:1px solid var(--border);margin:12px 0}
.small{font-size:.9rem}
@media (max-width:640px){
  .grid{grid-template-columns:1fr}
}
</style>
</head>
<body>
  <div class="card main">
    <div class="row" style="justify-content:space-between">
      <h1>‚úàÔ∏è ATA 31 - 34 Chpt 9</h1>
      <button id="themeToggle" class="btn-gray" title="Changer de th√®me">üåô/‚òÄÔ∏è</button>
    </div>

    <!-- Outils -->
    <div class="row">
      <div style="min-width:160px">
        <label class="small">Pseudo</label>
        <input id="pseudoInput" placeholder="Ton nom" maxlength="20" />
      </div>

      <div class="pill"><span>‚è±Ô∏è</span><b id="timer">0</b>s</div>
      <div class="pill">Score: <b id="score">0</b></div>
    </div>

    <!-- Question -->
    <div class="card" style="margin-top:10px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="font-size:1.2rem;font-weight:700">
          <span id="progressTxt">Question 0/0</span>
          <span id="prevBadge" class="badge-status">OK</span>
        </div>
        <div class="progressbar" style="flex:1;max-width:360px">
          <div id="progressBar"></div>
        </div>
      </div>
      <p id="question" style="font-size:1.25rem;font-weight:700;margin:8px 0">Clique sur D√©marrer</p>
      <div id="choices" class="grid"></div>
      <div id="feedback" class="muted" style="min-height:28px;margin-top:6px"></div>

      <div class="row" style="margin-top:8px">
        <button id="startBtn">D√©marrer</button>
        <button id="pauseBtn" class="btn-gray" disabled>Pause</button>
        <button id="stopBtn" class="btn-gray" disabled>Stop</button>
        <button id="resumeBtn" class="btn-gray" style="display:none">Reprendre</button>
      </div>
    </div>

    <!-- R√©sum√© -->
    <div id="summaryCard" class="card" style="margin-top:10px;display:none">
      <h3 style="margin:0 0 6px">R√©sum√©</h3>
      <div id="summaryStats" class="muted"></div>
      <div id="summaryList" class="muted" style="height:220px;overflow:auto;margin-top:8px"></div>
      <div class="row" style="margin-top:8px">
        <button id="printSummary" class="btn-gray">Imprimer</button>
        <button id="closeSummary" class="btn-gray">Fermer</button>
      </div>
    </div>

<div id="scoreBoardCard" class="card" style="margin-top:10px">
  <h3 style="margin:0 0 6px">Tableau des scores</h3>
  <div class="muted small">Affiche les 10 derniers (stocke 30 max).</div>
  <table>
    <thead>
      <tr><th>Pseudo</th><th>Score</th><th>%</th><th>Date</th></tr>
    </thead>
    <tbody id="scoreTableBody"></tbody>
  </table>
  <div class="row" style="margin-top:6px">
    <button id="clearScores" class="btn-gray">Effacer</button>
  </div>
</div>

    <!-- Progression -->
    <div class="card" style="margin-top:10px">
      <h3 style="margin:0 0 6px">üìà Progression</h3>
      <div class="svg-wrap"><svg id="chart" viewBox="0 0 320 120" width="100%" height="120" aria-label="Courbe des %"></svg></div>
    </div>
  </div>



<script>
// ====== Helpers
const $ = s => document.querySelector(s);
const pad2 = n => String(n).padStart(2,'0');
const nowStamp = () => { const d=new Date(); return `${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${String(d.getFullYear()).slice(-2)} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`; };
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }

// ====== Th√®me
const THEME_KEY='ata_theme';
(function applyTheme(){
  const t = localStorage.getItem(THEME_KEY)||'dark';
  document.documentElement.setAttribute('data-theme', t==='light'?'light':'dark');
})();
$('#themeToggle').onclick=()=>{
  const cur=document.documentElement.getAttribute('data-theme')==='light'?'light':'dark';
  const nxt=cur==='light'?'dark':'light';
  document.documentElement.setAttribute('data-theme',nxt);
  localStorage.setItem(THEME_KEY,nxt);
};

// ====== Storage keys
const LS_SCORES='ata31349_scores_v2';
const LS_PSEUDO='ata31349_pseudo_v2';
const LS_SNAPSHOT='ata31349_snapshot_v1';

// ====== √âtat
let running=false, paused=false, i=0, score=0;
let questionOrder=[], filteredQuestions=[];
let timeLeft=0, tickHandle=null, mode='TRAIN', perQ=15;
let answersLog=[];

// ====== DOM
const qEl=$('#question'), choicesEl=$('#choices'), feedbackEl=$('#feedback');
const timerEl=$('#timer'), scoreEl=$('#score'), progressTxt=$('#progressTxt'), progressBar=$('#progressBar');
const pseudoInput=$('#pseudoInput'); pseudoInput.value=localStorage.getItem(LS_PSEUDO)||'';
pseudoInput.addEventListener('change',()=>localStorage.setItem(LS_PSEUDO,pseudoInput.value.trim()));

// ====== Questions (exemple) ‚Äî remplace/compl√®te par ta liste compl√®te si besoin
 
let QUESTIONS = [
  { "q": "Le r√¥le principal d‚Äôune h√©lice sur un avion √† moteur est de :", "choices": ["Transformer une pression statique en portance utile", "Cr√©er un couple de r√©action pour stabiliser l‚Äôempennage", "Convertir la puissance m√©canique en traction propulsive", "Diminuer la tra√Æn√©e induite par l‚Äôaile en approche"], "answer": 2 },

  { "q": "Le pas th√©orique d‚Äôune h√©lice correspond √† :", "choices": ["La distance que l‚Äôh√©lice parcourrait en un tour sans glissement", "La distance r√©ellement parcourue par l‚Äôavion en un tour d‚Äôh√©lice", "La variation d‚Äôincidence au bord d‚Äôattaque sur un tour", "La course axiale du moyeu entre deux positions de but√©e"], "answer": 0 },

  { "q": "Le recul (slip) d‚Äôune h√©lice est d√©fini comme :", "choices": ["La diff√©rence entre calage au pied et au saumon de pale", "La r√©duction d‚ÄôEGT lors d‚Äôune mise en petit pas", "L‚Äô√©cart entre pas r√©el et pas th√©orique de l‚Äôh√©lice", "Le retard de r√©ponse du r√©gulateur en transitoire"], "answer": 3 },

  { "q": "Le vrillage d‚Äôune pale est n√©cessaire principalement pour :", "choices": ["R√©duire l‚Äô√©rosion au bord d‚Äôattaque en atmosph√®re pollu√©e", "Adapter l‚Äôincidence locale √† la vitesse lin√©aire croissante", "Compenser le d√©s√©quilibre dynamique en bout de pale", "Augmenter le moment fl√©chissant sous effort centrifuge"], "answer": 1 },

  { "q": "√Ä vitesse de rotation constante, le rendement d‚Äôune h√©lice √† pas fixe est maximal :", "choices": ["Pour une unique vitesse propre donn√©e de l‚Äôa√©ronef", "Pour toutes les vitesses si le r√©gime est stabilis√©", "Uniquement au d√©collage quand la traction est maximale", "Uniquement en descente lorsque le recul est nul"], "answer": 0 },

  { "q": "Sur une h√©lice √† pas fixe, en mont√©e lente, on observe g√©n√©ralement :", "choices": ["Un recul n√©gatif et une augmentation du r√©gime moteur", "Un recul nul et une tendance √† la survitesse h√©lice", "Un recul important et un r√©gime proche du sous-r√©gime", "Un recul constant et une pouss√©e ind√©pendante du pas"], "answer": 2 },

  { "q": "Le calage d‚Äôune pale est l‚Äôangle form√© entre :", "choices": ["La corde de la pale et le plan de rotation de l‚Äôh√©lice", "La corde de profil et l‚Äô√©coulement relatif local", "La g√©n√©ratrice du moyeu et la ligne de foi fuselage", "Le bord d‚Äôattaque et l‚Äôaxe du r√©ducteur moteur"], "answer": 1 },

  { "q": "Le calage de r√©f√©rence d‚Äôune pale d‚Äôh√©lice est classiquement mesur√© :", "choices": ["Au rayon 50 % pour limiter l‚Äôeffet de compressibilit√©", "Au rayon 30 % pour neutraliser le couple moteur", "Au rayon 70 % pour repr√©senter l‚Äôincidence moyenne", "Au rayon 90 % pour maximiser la pr√©cision angulaire"], "answer": 3 },

  { "q": "Une h√©lice √† pas variable permet principalement de :", "choices": ["Maintenir un r√©gime quasi constant pour un couple donn√©", "Maintenir une EGT constante quelle que soit la charge", "Supprimer les variations de couple sur la bo√Æte accessoire", "√âliminer la tra√Æn√©e en configuration d‚Äôapproche finale"], "answer": 0 },

  { "q": "Lorsqu‚Äôon augmente le pas sur une h√©lice √† vitesse constante, √† couple moteur inchang√© :", "choices": ["Le r√©gime augmente et la traction diminue mod√©r√©ment", "Le r√©gime reste constant et la traction s‚Äôajuste √† la charge", "Le r√©gime chute et le recul devient n√©gatif en croisi√®re", "Le r√©gime devient instable et la pale d√©croche instantan√©ment"], "answer": 2 },

  { "q": "L‚Äôangle d‚Äôincidence locale d‚Äôune pale d√©pend avant tout :", "choices": ["Du flux secondaire issue de la soufflante avant", "De la somme vectorielle vitesse rotation et vitesse avion", "Du gradient thermique dans le moyeu d‚Äôh√©lice", "Du rapport de pression total du compresseur"], "answer": 1 },

  { "q": "Sur paire d‚Äôh√©lices identiques, l‚Äôaugmentation de la vitesse propre de l‚Äôavion, √† r√©gime constant, tend √† :", "choices": ["Accro√Ætre le recul et r√©duire l‚Äôincidence effective", "R√©duire le recul et accro√Ætre l‚Äôincidence effective", "Imposer un calage plus faible au bord de fuite", "D√©placer le CG de la pale vers le moyeu"], "answer": 3 },

  { "q": "Le contr√¥le d‚Äôangle de pale avec un rapporteur universel se fait :", "choices": ["Au rep√®re de station d√©fini sur l‚Äôextrados de la pale", "√Ä proximit√© du saumon pour amplifier les √©carts minimes", "Uniquement c√¥ne d√©pos√© et moteur en drapeau", "Au pied de pale pour s‚Äôaffranchir du vrillage"], "answer": 0 },

  { "q": "Parmi ces affirmations, la plus correcte sur l‚Äôh√©lice et l‚Äôaile est :", "choices": ["L‚Äôh√©lice ne g√©n√®re pas de portance et donc pas de tra√Æn√©e", "Une pale se comporte comme une aile de profil tordu", "Le bord de fuite d‚Äôune pale est sym√©trique par conception", "Le vent relatif d‚Äôune pale est purement axial en vol"], "answer": 1 },

  { "q": "√Ä propos du pas r√©el d‚Äôune h√©lice, on peut dire qu‚Äôil est :", "choices": ["Toujours plus grand que le pas th√©orique en palier", "Toujours plus petit que le pas th√©orique en conditions r√©elles", "Ind√©pendant de la vitesse de l‚Äôa√©ronef en air calme", "Strictement √©gal au pas th√©orique √† r√©gime stabilis√©"], "answer": 2 },

  { "q": "Un r√©gulateur d‚Äôh√©lice en mode vitesse constante agit en priorit√© sur :", "choices": ["Le d√©bit carburant puis l‚Äôassiette longitudinale avion", "Le couple r√©ducteur puis la pression d‚Äôadmission", "Le pas de pale pour maintenir le r√©gime cible", "La temp√©rature huile pour r√©duire l‚Äôeffort axial"], "answer": 3 },

  { "q": "Sur une h√©lice, la vitesse lin√©aire en bout de pale est :", "choices": ["Inf√©rieure au pied de pale pour limiter le Mach local", "Identique sur toute la longueur par conception", "Plus √©lev√©e qu‚Äôau pied en raison du rayon plus grand", "Nulle au rayon o√π l‚Äôincidence est maximale"], "answer": 2 },

  { "q": "Le principal effet d‚Äôun vrillage bien dimensionn√© est :", "choices": ["Uniformiser l‚Äôincidence le long du rayon de pale", "Maximiser le couple r√©actif au d√©collage court", "R√©duire le bruit d‚Äôinteraction avec la cellule", "Augmenter la flexion de pale en croisi√®re rapide"], "answer": 0 },

  { "q": "En mont√©e initiale, une mauvaise gestion du pas variable peut conduire √† :", "choices": ["Un calage trop grand et un r√©gime trop faible", "Un calage trop grand et une EGT trop basse", "Un calage trop petit et une perte de traction", "Un calage trop petit et un couple constant"], "answer": 1 },

  { "q": "Dans une configuration de croisi√®re √©conomique, on recherche en g√©n√©ral :", "choices": ["Petit pas, r√©gime √©lev√©, traction soutenue", "Grand pas, r√©gime mod√©r√©, recul optimis√©", "Petit pas, r√©gime constant, recul minimal", "Grand pas, r√©gime maximal, traction maximale"], "answer": 3 },

  { "q": "La mesure du pas √† 70 % de rayon est pertinente car :", "choices": ["Elle minimise l‚Äôeffet des d√©fauts d‚Äô√©quilibrage statique", "Elle repr√©sente au mieux l‚Äôincidence moyenne utile", "Elle neutralise l‚Äôinfluence du flux induit par l‚Äôaile", "Elle s‚Äôaffranchit des erreurs de position du c√¥ne"], "answer": 0 },

  { "q": "Le lien correct entre recul et rendement h√©lice est :", "choices": ["Recul √©lev√© implique rendement accru en croisi√®re", "Recul nul implique rendement optimal en toute phase", "Recul mod√©r√© maximise le rendement au point de design", "Recul inverse maximise la traction au d√©collage long"], "answer": 2 },

  { "q": "Sur une h√©lice √† pas fixe, en descente √† grande vitesse, on observe typiquement :", "choices": ["Une tendance √† la survitesse et un recul diminu√©", "Un r√©gime constant et un recul inchang√©", "Une chute de r√©gime et un recul accru", "Une traction ind√©pendante du Mach local"], "answer": 3 },

  { "q": "Le param√®tre le plus directement r√©gul√© par un CSU (constant speed unit) est :", "choices": ["La pression d‚Äôadmission √† l‚Äôentr√©e compresseur", "La vitesse de rotation h√©lice vis√©e par consigne", "La temp√©rature culasse en fonction de la charge", "La pouss√©e nette corrig√©e des pertes d‚Äô√©chappement"], "answer": 1 },

  { "q": "La transformation √©nerg√©tique effectu√©e par l‚Äôh√©lice est d√©crite comme :", "choices": ["Conversion d‚Äô√©nergie thermique en √©nergie √©lectrique", "Conversion d‚Äô√©nergie m√©canique en √©nergie cin√©tique", "Conversion d‚Äô√©nergie chimique en √©nergie potentielle", "Conversion d‚Äô√©nergie magn√©tique en √©nergie de pression"], "answer": 2 },

  { "q": "Pour un d√©collage court, la configuration h√©lice optimale est :", "choices": ["Petit pas afin d‚Äôobtenir un r√©gime √©lev√© et forte traction", "Grand pas afin d‚Äôobtenir un recul faible et peu de bruit", "Petit pas afin d‚Äôobtenir une EGT minimale en rotation", "Grand pas afin d‚Äôobtenir une vitesse propre plus t√¥t"], "answer": 0 },

  { "q": "Le couple a√©rodynamique sur la pale varie notamment avec :", "choices": ["La densit√© air et le carr√© de la vitesse locale", "La pression statique et l‚ÄôEGT mesur√©e", "La masse carburant et le d√©bit huile", "Le r√©gime alternateur et la charge avionique"], "answer": 1 },

  { "q": "Une variation rapide de la manette de puissance sur h√©lice √† pas variable provoque :", "choices": ["Un ajustement transitoire du pas pour tenir le r√©gime", "Une variation d‚Äôassiette automatique de l‚Äôa√©ronef", "Un changement permanent du calage de r√©f√©rence", "Une annulation imm√©diate du recul mesur√©"], "answer": 3 },

  { "q": "Par rapport au pied de pale, le saumon est con√ßu avec :", "choices": ["Un calage moindre pour limiter l‚Äôincidence excessive", "Un calage accru pour augmenter la traction locale", "Un bord d‚Äôattaque plus √©pais pour le refroidissement", "Un bord de fuite droit pour la rigidit√© structurelle"], "answer": 2 },

  { "q": "L‚Äôoptimisation du rendement propulsif d‚Äôune h√©lice vise surtout √† :", "choices": ["R√©duire la vitesse d‚Äô√©jection du flux propulsif", "Augmenter la masse d‚Äôair acc√©l√©r√©e √† faible vitesse", "Maximiser la pression totale √† l‚Äôentr√©e de l‚Äôh√©lice", "Minimiser l‚Äôangle de calage au pied de pale"], "answer": 0 },

  { "q": "La condition de ¬´ vitesse constante ¬ª signifie :", "choices": ["Le r√©gime h√©lice est maintenu malgr√© les variations de charge", "La vitesse propre avion est maintenue malgr√© le vent r√©el", "Le couple moteur est constant quelle que soit la densit√©", "Le pas h√©lice ne varie pas pendant la man≈ìuvre"], "answer": 1 },

  { "q": "Concernant l‚Äôincidence de pale, on peut affirmer que :", "choices": ["Elle d√©cro√Æt vers le saumon pour rester proche de l‚Äôoptimum", "Elle reste identique sur toute la longueur de la pale", "Elle augmente vers le pied quelle que soit la phase de vol", "Elle est ind√©pendante de la vitesse propre de l‚Äôavion"], "answer": 3 },

  { "q": "Le choix d‚Äôun grand pas en croisi√®re permet :", "choices": ["De maintenir un r√©gime bas et une bonne efficacit√©", "D‚Äôaugmenter le r√©gime pour r√©duire le recul", "De diminuer la traction et la stabilit√© lat√©rale", "D‚Äôaugmenter le bruit cabine √† puissance √©gale"], "answer": 2 },

  { "q": "Dans la plage d‚Äôutilisation normale, un bon r√©glage de pas variable doit :", "choices": ["√âviter la survitesse et maintenir la traction requise", "Annuler le recul pour garantir la portance maximale", "Imposer un calage fixe sur toute la phase de vol", "Forcer la pale √† l‚Äôangle minimal en approche finale"], "answer": 3 },

  { "q": "La d√©finition correcte du calage mesur√© est :", "choices": ["Angle corde‚Äìplan de rotation au rep√®re de station", "Angle corde‚Äì√©coulement relatif √† 70 % de rayon", "Angle bord d‚Äôattaque‚Äìaxe moteur au pied de pale", "Angle bord de fuite‚Äìplan de sym√©trie de l‚Äôaile"], "answer": 2 },

  { "q": "Le vent relatif vu par une section de pale combine :", "choices": ["La vitesse avion et la vitesse de rotation locale", "La vitesse de l‚Äô√©coulement secondaire seul", "La vitesse de l‚Äôair ambiant uniquement", "La vitesse induite par l‚Äôaile uniquement"], "answer": 0 },

  { "q": "Sur une h√©lice √† pas fixe, une augmentation de la vitesse propre tend √† :", "choices": ["Diminuer l‚Äôincidence et r√©duire le couple absorb√©", "Augmenter l‚Äôincidence et augmenter le couple", "Maintenir l‚Äôincidence et r√©duire la traction", "Inverser l‚Äô√©coulement et annuler la pouss√©e"], "answer": 3 },

  { "q": "Le meilleur √©nonc√© sur pas r√©el et incidence est :", "choices": ["Pas r√©el plus grand r√©duit l‚Äôincidence locale de pale", "Pas r√©el plus petit r√©duit l‚Äôincidence locale de pale", "Pas r√©el √©gal annule l‚Äôincidence sur toute la pale", "Pas r√©el variable impose incidence ind√©pendante"], "answer": 1 }
];

;
// üëâ Tu peux coller ici ta grosse liste compl√®te : le code fonctionne pareil.

// ====== Scores (stock 30, affichage 10)
function loadScores(){ try{ return JSON.parse(localStorage.getItem(LS_SCORES)||'[]') }catch{ return [] } }
function saveScores(list){ localStorage.setItem(LS_SCORES, JSON.stringify(list.slice(-30))); }
function addScoreRow(entry){
  const pct = entry.total ? Math.round(entry.score/entry.total*1000)/10 : 0;
  const tr=document.createElement('tr');
  tr.innerHTML = `<td>${entry.name||'‚Äî'}</td><td>${entry.score}/${entry.total}</td><td>${pct}%</td><td>${entry.when}</td>`;
  $('#scoreTableBody').appendChild(tr);
}
function renderScoreTable(){
  const body=$('#scoreTableBody'); body.innerHTML='';
  const list=loadScores(); const view=list.slice(-10).reverse(); // 10 derniers, r√©cents en haut
  view.forEach(addScoreRow);
}
$('#clearScores').onclick=()=>{ localStorage.removeItem(LS_SCORES); renderScoreTable(); drawChart(); };

// ====== Graph progression (utilise jusqu‚Äô√† 30 entr√©es)
function drawChart(){
  const svg=$('#chart'); svg.innerHTML='';
  const list=loadScores(); const values=list.map(e=>Math.round(e.score/e.total*100));
  const N=values.length, W=320, H=120, pad=12;
  // axes
  const ax=document.createElementNS('http://www.w3.org/2000/svg','path');
  ax.setAttribute('d',`M${pad},${H-pad}H${W-pad} M${pad},${pad}V${H-pad}`);
  ax.setAttribute('stroke','currentColor'); ax.setAttribute('fill','none'); ax.setAttribute('opacity','0.4');
  svg.appendChild(ax);
  if(!N) return;
  const start=Math.max(0,N-20), arr=values.slice(start);
  const step=(W-2*pad)/Math.max(1,arr.length-1);
  const pts=arr.map((v,k)=>[pad+k*step,(H-pad)-(v/100)*(H-2*pad)]);
  const d=pts.map((p,k)=>(k?'L':'M')+p[0]+','+p[1]).join(' ');
  const path=document.createElementNS('http://www.w3.org/2000/svg','path');
  path.setAttribute('d',d); path.setAttribute('fill','none'); path.setAttribute('stroke','currentColor');
  svg.appendChild(path);
}
renderScoreTable(); drawChart();

// ====== Timer
function clearTick(){ if(tickHandle){ clearInterval(tickHandle); tickHandle=null; } }
function setTimer(v){ timerEl.textContent=v; }
function startTick(){
  clearTick(); timeLeft=perQ; setTimer(timeLeft);
  tickHandle=setInterval(()=>{ if(paused) return; timeLeft--; setTimer(Math.max(0,timeLeft)); if(timeLeft<=0){ clearTick(); onTimeout(); } },1000);
}

// ====== Progress + badge
function renderProgress(){
  const total=filteredQuestions.length;
  progressTxt.textContent=`Question ${Math.min(i+1,total)}/${total}`;
  const pct = total? Math.round(i/total*100) : 0;
  progressBar.style.width = pct+'%';
}
function showBadge(kind){
  const el=$('#prevBadge'); el.className='badge-status';
  if(!kind){ el.style.display='none'; return; }
  el.style.display='inline-block';
  el.textContent = kind==='ok'?'OK':(kind==='bad'?'FAUX':'BOF');
  el.classList.add(kind==='ok'?'badge-ok':(kind==='bad'?'badge-bad':'badge-bof'));
  setTimeout(()=>{ el.style.display='none'; }, 1500);
}

// ====== Rendu question (m√©lange des r√©ponses)
function renderQuestion(){
  const total=filteredQuestions.length;
  if(i>=total){ finishGame(); return; }

  const current=filteredQuestions[questionOrder[i]];
  const shuffled = current.choices.map((text,idx)=>({text,idx})).sort(()=>Math.random()-0.5);
  current.shuffledMap = shuffled.map(o=>o.idx);
  current.shuffledAnswer = shuffled.findIndex(o=>o.idx===current.answer);

  qEl.textContent=current.q;
  renderProgress();
  feedbackEl.textContent='';
  choicesEl.innerHTML='';

  shuffled.forEach((item, idx)=>{
    const b=document.createElement('button');
    b.className='opt'; b.textContent=item.text;
    b.addEventListener('click', ()=> onSelect(idx, b));
    choicesEl.appendChild(b);
  });

  if(running && !paused) startTick();
}
function highlightGood(){
  const cur=filteredQuestions[questionOrder[i]];
  const good = (cur && typeof cur.shuffledAnswer==='number') ? cur.shuffledAnswer : cur.answer;
  document.querySelectorAll('.opt').forEach((b,idx)=>{ b.disabled=true; if(idx===good) b.classList.add('correct'); });
}
function disableAll(){ document.querySelectorAll('.opt').forEach(b=>b.disabled=true); }

// ====== S√©lection / Timeout
function onSelect(idx, btn){
  if(!running || paused) return;
  clearTick();
  const curQ=filteredQuestions[questionOrder[i]];
  const goodShuffled = (typeof curQ.shuffledAnswer==='number') ? curQ.shuffledAnswer : curQ.answer;
  const pickedOriginal = Array.isArray(curQ.shuffledMap) ? curQ.shuffledMap[idx] : idx;

  // log pour le r√©sum√©
  answersLog[i] = {
    index:i, q:curQ.q, choices:curQ.choices.slice(),
    correctIndex:curQ.answer, pickedIndex:pickedOriginal,
    correct:(idx===goodShuffled), timedOut:false
  };

  if(mode==='TRAIN'){
    highlightGood();
    if(idx===goodShuffled){
      score++; scoreEl.textContent=score;
      feedbackEl.innerHTML = `<span class="ok"><b>Bonne r√©ponse !</b></span>`;
      showBadge('ok');
    }else{
      btn.classList.add('wrong');
      feedbackEl.innerHTML = `<span class="bad"><b>Faux.</b></span>`;
      showBadge('bad');
    }
  }else{
    disableAll(); // examen : pas de correction imm√©diate
  }

  setTimeout(()=>{ i++; renderQuestion(); }, 800);
}
function onTimeout(){
  if(!running) return;
  const curQ=filteredQuestions[questionOrder[i]];
  answersLog[i] = {
    index:i, q:curQ.q, choices:curQ.choices.slice(),
    correctIndex:curQ.answer, pickedIndex:null, correct:false, timedOut:true
  };
  if(mode==='TRAIN'){
    highlightGood();
    feedbackEl.innerHTML = `<span class="muted"><b>Temps √©coul√©.</b></span>`;
    showBadge('bad');
  }else{
    disableAll();
  }
  setTimeout(()=>{ i++; renderQuestion(); }, 800);
}

// ====== S√©lection des questions
function buildFilteredQuestions(){
  // Utiliser TOUTES les questions disponibles
  const arr = shuffle(QUESTIONS.map((q, idx) => ({ q, idx })));
  filteredQuestions = arr.map(o => o.q);
  questionOrder = shuffle([...filteredQuestions.keys()]);
}


// ====== D√©marrer / Pause / Stop
function resetState(){
  running=false; paused=false; i=0; score=0; answersLog=[];
  scoreEl.textConte